{"id":"moon_cosmic-mc2","title":"Implement moon_cosmic to match cosmic-text-reference using moon_swash","description":"Goal: bring this MoonBit cosmic port in src/ to feature parity (as scoped by tests and public API) with the reference implementation under ./cosmic-text-reference (user called it ./cosmic-reference).","status":"closed","priority":1,"issue_type":"epic","owner":"842376130@qq.com","created_at":"2026-01-29T10:03:46.212412+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:11:46.731988+08:00","closed_at":"2026-01-29T12:11:46.731988+08:00","close_reason":"Closed","labels":["cosmic","port"]}
{"id":"moon_cosmic-mc2.1","title":"Add/resolve dependency Milky2018/moon_swash","description":"Run moon add/update so Milky2018/moon_swash is resolvable; ensure moon test runs.","notes":"Installed moon_swash via moon add; fixed cmd/main to compile (prints cosmic_text_version); moon test passes.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T10:03:54.716746+08:00","created_by":"Milky2018","updated_at":"2026-01-29T10:05:21.720003+08:00","closed_at":"2026-01-29T10:05:21.720006+08:00","labels":["deps"],"dependencies":[{"issue_id":"moon_cosmic-mc2.1","depends_on_id":"moon_cosmic-mc2","type":"parent-child","created_at":"2026-01-29T10:03:54.717411+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-mc2.2","title":"Replace MVP shaping with swash-based shaping/metrics","description":"Implement shaping and per-glyph advances using moon_swash; wire into layout/buffer.","notes":"Implemented core glyph cache primitives (CacheKey/SubpixelBin + tests), added minimal FontSystem backed by moon_swash, added ShapeLine::build_with_font_system using moon_swash charmap+metrics, and added SwashCache (moon_swash/scale) with image caching + with_pixels.\nAdded SwashCache outline commands cache (path data), variable font weight axis (wght) support, and fake italic transform handling for rendering parity.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T10:03:54.794497+08:00","created_by":"Milky2018","updated_at":"2026-01-29T11:28:04.170833+08:00","closed_at":"2026-01-29T11:28:04.170833+08:00","close_reason":"Closed","labels":["shaping"],"dependencies":[{"issue_id":"moon_cosmic-mc2.2","depends_on_id":"moon_cosmic-mc2","type":"parent-child","created_at":"2026-01-29T10:03:54.795137+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-mc2.3","title":"Align public API/tests with reference","description":"Compare exposed types/functions with ./cosmic-text-reference; add/adjust tests for parity.","notes":"Added Buffer::layout_all + Buffer::layout_runs (LayoutRun) and fixed WordOrGlyph wrapping to account for skipped whitespace + correctly glyph-wrap overlong words; added wrap_word_fallback-style regression test.\nPorted render.rs (Renderer + LegacyRenderer) and added Buffer::draw wrapper + smoke test.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T10:03:54.872607+08:00","created_by":"Milky2018","updated_at":"2026-01-29T11:28:14.458949+08:00","closed_at":"2026-01-29T11:28:14.458949+08:00","close_reason":"Closed","labels":["tests"],"dependencies":[{"issue_id":"moon_cosmic-mc2.3","depends_on_id":"moon_cosmic-mc2","type":"parent-child","created_at":"2026-01-29T10:03:54.873243+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-mc2.4","title":"Implement cluster shaping + bidi/rtl handling","description":"Switch ShapeLine/Buffer layout to operate on shaped glyph clusters (not 1 code unit = 1 glyph), add bidi paragraph direction + rtl shaping parity with cosmic-text-reference.","notes":"Added first-strong-direction RTL detection (ShapeLine.rtl) and made layout reverse glyph order when rtl; improved tab stop advance in font-based shaping (tabs snap to next stop like upstream).\nImplemented cluster-based shaping for Advanced via moon_swash/shape Shaper (size=1.0 em units) with UTF-16 code-unit offsets, propagated x/y offsets, added ShapeGlyph/ShapeLine constructors for blackbox tests; rewrote layout_from_shape to operate on glyph indices (not text length) with word/glyph wrapping based on glyph\u003c-\u003etext mapping and pixel-accurate advances; added regression tests for non-1:1 glyph coverage.\nRefined Advanced shaping to partition by unicode Script runs (Common/Inherited/Unknown treated as current), shaping each run separately with swash Shaper while preserving UTF-16 offsets.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T10:43:14.043162+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:11:39.830644+08:00","closed_at":"2026-01-29T12:11:39.830644+08:00","close_reason":"Closed","labels":["bidi","shaping"],"dependencies":[{"issue_id":"moon_cosmic-mc2.4","depends_on_id":"moon_cosmic-mc2","type":"parent-child","created_at":"2026-01-29T10:43:14.043754+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-mc2.5","title":"Add Renderer/Buffer.draw API with SwashCache","description":"Port render.rs + Buffer.draw flow; use SwashCache::with_pixels to rasterize and invoke callback like upstream cosmic-text.","notes":"Implemented LayoutGlyph/PhysicalGlyph + LayoutGlyph::physical + CacheKey bin getters; added Buffer::draw_with_font_system that renders via SwashCache::with_pixels (legacy per-pixel callback).","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T10:43:14.117832+08:00","created_by":"Milky2018","updated_at":"2026-01-29T11:18:13.883841+08:00","closed_at":"2026-01-29T11:18:13.883841+08:00","close_reason":"Closed","labels":["render","swash"],"dependencies":[{"issue_id":"moon_cosmic-mc2.5","depends_on_id":"moon_cosmic-mc2","type":"parent-child","created_at":"2026-01-29T10:43:14.118554+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-vvr","title":"Full parity with cosmic-text-reference","description":"Match cosmic-text-reference functionality end-to-end: font system+fallback, shaping/bidi, layout, rendering, and editing APIs.","status":"open","priority":1,"issue_type":"epic","owner":"842376130@qq.com","created_at":"2026-01-29T12:21:20.530205+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:21:20.530205+08:00","labels":["cosmic","parity"]}
{"id":"moon_cosmic-vvr.1","title":"Port math + shape_run_cache","description":"Add math helpers and shape run cache structures (ShapeRunKey/ShapeRunCache) like cosmic-text-reference, and wire into shaping pipeline where appropriate.","notes":"Added src/math.mbt (floorf/roundf/truncf) and src/shape_run_cache.mbt (ShapeRunKey/ShapeRunCache with get/peek/insert/trim) plus hashing support for Attrs/Family/Weight and unit tests.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T12:21:33.26541+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:29:01.668912+08:00","closed_at":"2026-01-29T12:29:01.668912+08:00","close_reason":"Closed","labels":["cache","math"],"dependencies":[{"issue_id":"moon_cosmic-vvr.1","depends_on_id":"moon_cosmic-vvr","type":"parent-child","created_at":"2026-01-29T12:21:33.266163+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-vvr.2","title":"Port edit/editor module","description":"Implement cosmic-text edit module: Editor, selection, editing operations, and any vi helpers needed for parity with cosmic-text-reference.","status":"in_progress","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T12:21:33.350778+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:32:50.709243+08:00","labels":["edit"],"dependencies":[{"issue_id":"moon_cosmic-vvr.2","depends_on_id":"moon_cosmic-vvr","type":"parent-child","created_at":"2026-01-29T12:21:33.351438+08:00","created_by":"Milky2018"}],"comments":[{"id":1,"issue_id":"moon_cosmic-vvr.2","author":"Milky2018","text":"Added edit primitives (Action/Selection/Change/ChangeItem) + equality fixes; added edit tests; still need Editor + edit operations parity.","created_at":"2026-01-29T04:41:44Z"},{"id":2,"issue_id":"moon_cosmic-vvr.2","author":"Milky2018","text":"Added minimal Editor scaffold + selection_bounds (None/Normal/Line/Word with whitespace segmentation MVP) and tests. Added Buffer::set_redraw helper for cursor movement parity.","created_at":"2026-01-29T04:48:02Z"}]}
{"id":"moon_cosmic-vvr.2.1","title":"Implement Editor action/motion + insert/delete parity","description":"Port core Editor editing logic from cosmic-text-reference: action(), cursor motion, selection updates, insert_at/delete_range, change tracking (start/finish/apply).","status":"in_progress","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T12:49:21.194925+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:49:35.001243+08:00","labels":["edit"],"dependencies":[{"issue_id":"moon_cosmic-vvr.2.1","depends_on_id":"moon_cosmic-vvr.2","type":"parent-child","created_at":"2026-01-29T12:49:21.195464+08:00","created_by":"Milky2018"}],"comments":[{"id":3,"issue_id":"moon_cosmic-vvr.2.1","author":"Milky2018","text":"Implemented Editor.insert_at and Editor.delete_range (functional style) + tests. Insert_at currently treats attrs_list_opt as defaults-only (spans ignored) as MVP.","created_at":"2026-01-29T04:58:09Z"},{"id":4,"issue_id":"moon_cosmic-vvr.2.1","author":"Milky2018","text":"Implemented Editor action pipeline (Insert/Enter/Backspace/Delete/Indent/Unindent/Escape + text-index Motion) + copy_selection/delete_selection/insert_string/apply_change + change tracking for delete_range. Added editor_action_test.","created_at":"2026-01-29T05:13:30Z"},{"id":5,"issue_id":"moon_cosmic-vvr.2.1","author":"Milky2018","text":"Updated Editor.insert_at to apply full AttrsList (defaults+spans) and split attrs across inserted lines; added attrs split test.","created_at":"2026-01-29T05:16:40Z"},{"id":8,"issue_id":"moon_cosmic-vvr.2.1","author":"Milky2018","text":"Motion handling now delegates to Buffer::cursor_motion (layout-run based vertical movement + cursor_x_opt) instead of text-only cursor_motion.","created_at":"2026-01-29T05:30:58Z"},{"id":12,"issue_id":"moon_cosmic-vvr.2.1","author":"Milky2018","text":"Fixed SoftHome motion parity: Buffer::cursor_motion now toggles between after-leading-whitespace and column 0; non-vertical motions no longer require mapping cursor-\u003elayout run (avoids None for SoftHome). Added regression test.","created_at":"2026-01-29T05:56:53Z"},{"id":13,"issue_id":"moon_cosmic-vvr.2.1","author":"Milky2018","text":"Corrected SoftHome behavior to match cosmic-text-reference: always jump to first non-whitespace (no toggle) and return 0 for all-whitespace lines; updated tests.","created_at":"2026-01-29T06:01:43Z"},{"id":15,"issue_id":"moon_cosmic-vvr.2.1","author":"Milky2018","text":"Improved motion parity: Buffer::cursor_motion now supports Motion::LayoutCursor (visual-run based) and Home/End now operate on current visual run (wrap-aware) with affinity After/Before; added wrap regression test.","created_at":"2026-01-29T06:12:38Z"}]}
{"id":"moon_cosmic-vvr.2.2","title":"Upgrade word segmentation to UAX#29 for Selection::Word","description":"Replace whitespace-only segmentation used by Editor.selection_bounds with Unicode word boundary algorithm to match cosmic-text-reference (unicode_segmentation).","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T12:49:21.271228+08:00","created_by":"Milky2018","updated_at":"2026-01-29T13:38:13.626848+08:00","closed_at":"2026-01-29T13:38:13.626848+08:00","close_reason":"Closed","labels":["edit","segment"],"dependencies":[{"issue_id":"moon_cosmic-vvr.2.2","depends_on_id":"moon_cosmic-vvr.2","type":"parent-child","created_at":"2026-01-29T12:49:21.271817+08:00","created_by":"Milky2018"}],"comments":[{"id":9,"issue_id":"moon_cosmic-vvr.2.2","author":"Milky2018","text":"Added segment.word_indices_uax29 using moon_swash Analyze+Boundary; switched Selection::Word expansion to this; Buffer::cursor_motion now supports word motions using uax29 ranges.","created_at":"2026-01-29T05:37:22Z"}]}
{"id":"moon_cosmic-vvr.2.3","title":"Implement Editor render/cursor_position using Renderer","description":"Add Editor::render (and optional draw wrapper) that highlights selection and cursor using Renderer, aligned with cosmic-text-reference behavior. Needs LayoutRun metadata (line_top/line_height) or equivalent mapping.","status":"in_progress","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T12:49:21.34669+08:00","created_by":"Milky2018","updated_at":"2026-01-29T13:18:15.453454+08:00","labels":["edit","render"],"dependencies":[{"issue_id":"moon_cosmic-vvr.2.3","depends_on_id":"moon_cosmic-vvr.2","type":"parent-child","created_at":"2026-01-29T12:49:21.347275+08:00","created_by":"Milky2018"}],"comments":[{"id":6,"issue_id":"moon_cosmic-vvr.2.3","author":"Milky2018","text":"Extended Buffer::layout_runs with y/top/height; added Editor::cursor_position + generic Editor::render (selection/cursor highlight MVP) and tests with TestRenderer.","created_at":"2026-01-29T05:22:50Z"},{"id":7,"issue_id":"moon_cosmic-vvr.2.3","author":"Milky2018","text":"Added Buffer::hit + Buffer::set_scroll; wired Editor.action Click/DoubleClick/TripleClick/Drag/Scroll to hit-testing and scroll; added tests.","created_at":"2026-01-29T05:25:46Z"},{"id":16,"issue_id":"moon_cosmic-vvr.2.3","author":"Milky2018","text":"Improved Editor::render selection painting to match cosmic-text-reference: per-glyph grapheme subdivision (using grapheme_indices_uax29) and highlight internal empty lines (full width). Added regression test for empty-line selection highlight.","created_at":"2026-01-29T06:18:19Z"}]}
{"id":"moon_cosmic-vvr.2.4","title":"Align Indent/Unindent behavior with cosmic-text-reference","description":"Current Editor.action Indent/Unindent is MVP (line-start spaces). Port upstream tab-stop based indentation and cursor/selection adjustment semantics.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T13:17:27.78654+08:00","created_by":"Milky2018","updated_at":"2026-01-29T13:50:15.243288+08:00","closed_at":"2026-01-29T13:50:15.243288+08:00","close_reason":"Closed","labels":["edit"],"dependencies":[{"issue_id":"moon_cosmic-vvr.2.4","depends_on_id":"moon_cosmic-vvr.2","type":"parent-child","created_at":"2026-01-29T13:17:27.78723+08:00","created_by":"Milky2018"}],"comments":[{"id":11,"issue_id":"moon_cosmic-vvr.2.4","author":"Milky2018","text":"Reimplemented Editor.action Indent/Unindent to match cosmic-text-reference tab-stop semantics: compute after_whitespace + last_indent, indent to next tab stop, deindent one tab stop chunk; adjust cursor/selection indices accordingly; added editor_indent_test.","created_at":"2026-01-29T05:49:27Z"}]}
{"id":"moon_cosmic-vvr.2.5","title":"Make Backspace/Delete and word motions grapheme-aware","description":"Use Unicode grapheme/word boundaries for Backspace/Delete and word motions (PrevWord/NextWord etc) to match cosmic-text-reference.","status":"in_progress","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T13:17:27.872665+08:00","created_by":"Milky2018","updated_at":"2026-01-29T13:39:51.164087+08:00","labels":["edit","segment"],"dependencies":[{"issue_id":"moon_cosmic-vvr.2.5","depends_on_id":"moon_cosmic-vvr.2","type":"parent-child","created_at":"2026-01-29T13:17:27.873357+08:00","created_by":"Milky2018"}],"comments":[{"id":10,"issue_id":"moon_cosmic-vvr.2.5","author":"Milky2018","text":"Added grapheme_indices_uax29 (UAX#29-ish) using moon_swash ClusterBreak; updated Editor.action Backspace/Delete to delete grapheme clusters; added combining-mark test.","created_at":"2026-01-29T05:41:42Z"},{"id":14,"issue_id":"moon_cosmic-vvr.2.5","author":"Milky2018","text":"Implemented grapheme-aware Previous/Next (and thus Left/Right in LTR fallback) in Buffer::cursor_motion using grapheme_indices_uax29; sets affinity to After/Before like upstream. Added regression test for combining mark cluster.","created_at":"2026-01-29T06:05:02Z"}]}
{"id":"moon_cosmic-vvr.3","title":"Implement FontSystem + font fallback parity","description":"Bring FontSystem/font module in line with cosmic-text-reference: font discovery, family/style/weight matching, fallback lists, and glyph availability checks.","status":"open","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T12:21:33.437686+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:21:33.437686+08:00","labels":["fallback","font"],"dependencies":[{"issue_id":"moon_cosmic-vvr.3","depends_on_id":"moon_cosmic-vvr","type":"parent-child","created_at":"2026-01-29T12:21:33.43835+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-vvr.4","title":"Implement bidi paragraph boundaries + visual runs","description":"Match cosmic-text bidi paragraph handling and visual order runs (beyond base-direction heuristic), including paragraph iteration and selection behavior.","status":"open","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T12:21:33.524981+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:21:33.524981+08:00","labels":["bidi"],"dependencies":[{"issue_id":"moon_cosmic-vvr.4","depends_on_id":"moon_cosmic-vvr","type":"parent-child","created_at":"2026-01-29T12:21:33.525631+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-vvr.5","title":"Port/align test suite with cosmic-text-reference","description":"Add MoonBit tests that mirror cosmic-text-reference behavior (layout, shaping, editing, selection, raster cache).","status":"open","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T12:21:33.612474+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:21:33.612474+08:00","labels":["tests"],"dependencies":[{"issue_id":"moon_cosmic-vvr.5","depends_on_id":"moon_cosmic-vvr","type":"parent-child","created_at":"2026-01-29T12:21:33.613219+08:00","created_by":"Milky2018"}]}
