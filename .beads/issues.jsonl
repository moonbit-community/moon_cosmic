{"id":"moon_cosmic-mc2","title":"Implement moon_cosmic to match cosmic-text-reference using moon_swash","description":"Goal: bring this MoonBit cosmic port in src/ to feature parity (as scoped by tests and public API) with the reference implementation under ./cosmic-text-reference (user called it ./cosmic-reference).","status":"closed","priority":1,"issue_type":"epic","owner":"842376130@qq.com","created_at":"2026-01-29T10:03:46.212412+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:11:46.731988+08:00","closed_at":"2026-01-29T12:11:46.731988+08:00","close_reason":"Closed","labels":["cosmic","port"]}
{"id":"moon_cosmic-mc2.1","title":"Add/resolve dependency Milky2018/moon_swash","description":"Run moon add/update so Milky2018/moon_swash is resolvable; ensure moon test runs.","notes":"Installed moon_swash via moon add; fixed cmd/main to compile (prints cosmic_text_version); moon test passes.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T10:03:54.716746+08:00","created_by":"Milky2018","updated_at":"2026-01-29T10:05:21.720003+08:00","closed_at":"2026-01-29T10:05:21.720006+08:00","labels":["deps"],"dependencies":[{"issue_id":"moon_cosmic-mc2.1","depends_on_id":"moon_cosmic-mc2","type":"parent-child","created_at":"2026-01-29T10:03:54.717411+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-mc2.2","title":"Replace MVP shaping with swash-based shaping/metrics","description":"Implement shaping and per-glyph advances using moon_swash; wire into layout/buffer.","notes":"Implemented core glyph cache primitives (CacheKey/SubpixelBin + tests), added minimal FontSystem backed by moon_swash, added ShapeLine::build_with_font_system using moon_swash charmap+metrics, and added SwashCache (moon_swash/scale) with image caching + with_pixels.\nAdded SwashCache outline commands cache (path data), variable font weight axis (wght) support, and fake italic transform handling for rendering parity.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T10:03:54.794497+08:00","created_by":"Milky2018","updated_at":"2026-01-29T11:28:04.170833+08:00","closed_at":"2026-01-29T11:28:04.170833+08:00","close_reason":"Closed","labels":["shaping"],"dependencies":[{"issue_id":"moon_cosmic-mc2.2","depends_on_id":"moon_cosmic-mc2","type":"parent-child","created_at":"2026-01-29T10:03:54.795137+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-mc2.3","title":"Align public API/tests with reference","description":"Compare exposed types/functions with ./cosmic-text-reference; add/adjust tests for parity.","notes":"Added Buffer::layout_all + Buffer::layout_runs (LayoutRun) and fixed WordOrGlyph wrapping to account for skipped whitespace + correctly glyph-wrap overlong words; added wrap_word_fallback-style regression test.\nPorted render.rs (Renderer + LegacyRenderer) and added Buffer::draw wrapper + smoke test.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T10:03:54.872607+08:00","created_by":"Milky2018","updated_at":"2026-01-29T11:28:14.458949+08:00","closed_at":"2026-01-29T11:28:14.458949+08:00","close_reason":"Closed","labels":["tests"],"dependencies":[{"issue_id":"moon_cosmic-mc2.3","depends_on_id":"moon_cosmic-mc2","type":"parent-child","created_at":"2026-01-29T10:03:54.873243+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-mc2.4","title":"Implement cluster shaping + bidi/rtl handling","description":"Switch ShapeLine/Buffer layout to operate on shaped glyph clusters (not 1 code unit = 1 glyph), add bidi paragraph direction + rtl shaping parity with cosmic-text-reference.","notes":"Added first-strong-direction RTL detection (ShapeLine.rtl) and made layout reverse glyph order when rtl; improved tab stop advance in font-based shaping (tabs snap to next stop like upstream).\nImplemented cluster-based shaping for Advanced via moon_swash/shape Shaper (size=1.0 em units) with UTF-16 code-unit offsets, propagated x/y offsets, added ShapeGlyph/ShapeLine constructors for blackbox tests; rewrote layout_from_shape to operate on glyph indices (not text length) with word/glyph wrapping based on glyph\u003c-\u003etext mapping and pixel-accurate advances; added regression tests for non-1:1 glyph coverage.\nRefined Advanced shaping to partition by unicode Script runs (Common/Inherited/Unknown treated as current), shaping each run separately with swash Shaper while preserving UTF-16 offsets.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T10:43:14.043162+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:11:39.830644+08:00","closed_at":"2026-01-29T12:11:39.830644+08:00","close_reason":"Closed","labels":["bidi","shaping"],"dependencies":[{"issue_id":"moon_cosmic-mc2.4","depends_on_id":"moon_cosmic-mc2","type":"parent-child","created_at":"2026-01-29T10:43:14.043754+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-mc2.5","title":"Add Renderer/Buffer.draw API with SwashCache","description":"Port render.rs + Buffer.draw flow; use SwashCache::with_pixels to rasterize and invoke callback like upstream cosmic-text.","notes":"Implemented LayoutGlyph/PhysicalGlyph + LayoutGlyph::physical + CacheKey bin getters; added Buffer::draw_with_font_system that renders via SwashCache::with_pixels (legacy per-pixel callback).","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T10:43:14.117832+08:00","created_by":"Milky2018","updated_at":"2026-01-29T11:18:13.883841+08:00","closed_at":"2026-01-29T11:18:13.883841+08:00","close_reason":"Closed","labels":["render","swash"],"dependencies":[{"issue_id":"moon_cosmic-mc2.5","depends_on_id":"moon_cosmic-mc2","type":"parent-child","created_at":"2026-01-29T10:43:14.118554+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-vvr","title":"Full parity with cosmic-text-reference","description":"Match cosmic-text-reference functionality end-to-end: font system+fallback, shaping/bidi, layout, rendering, and editing APIs.","status":"open","priority":1,"issue_type":"epic","owner":"842376130@qq.com","created_at":"2026-01-29T12:21:20.530205+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:21:20.530205+08:00","labels":["cosmic","parity"]}
{"id":"moon_cosmic-vvr.1","title":"Port math + shape_run_cache","description":"Add math helpers and shape run cache structures (ShapeRunKey/ShapeRunCache) like cosmic-text-reference, and wire into shaping pipeline where appropriate.","notes":"Added src/math.mbt (floorf/roundf/truncf) and src/shape_run_cache.mbt (ShapeRunKey/ShapeRunCache with get/peek/insert/trim) plus hashing support for Attrs/Family/Weight and unit tests.","status":"closed","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T12:21:33.26541+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:29:01.668912+08:00","closed_at":"2026-01-29T12:29:01.668912+08:00","close_reason":"Closed","labels":["cache","math"],"dependencies":[{"issue_id":"moon_cosmic-vvr.1","depends_on_id":"moon_cosmic-vvr","type":"parent-child","created_at":"2026-01-29T12:21:33.266163+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-vvr.2","title":"Port edit/editor module","description":"Implement cosmic-text edit module: Editor, selection, editing operations, and any vi helpers needed for parity with cosmic-text-reference.","status":"in_progress","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T12:21:33.350778+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:32:50.709243+08:00","labels":["edit"],"dependencies":[{"issue_id":"moon_cosmic-vvr.2","depends_on_id":"moon_cosmic-vvr","type":"parent-child","created_at":"2026-01-29T12:21:33.351438+08:00","created_by":"Milky2018"}],"comments":[{"id":1,"issue_id":"moon_cosmic-vvr.2","author":"Milky2018","text":"Added edit primitives (Action/Selection/Change/ChangeItem) + equality fixes; added edit tests; still need Editor + edit operations parity.","created_at":"2026-01-29T04:41:44Z"},{"id":2,"issue_id":"moon_cosmic-vvr.2","author":"Milky2018","text":"Added minimal Editor scaffold + selection_bounds (None/Normal/Line/Word with whitespace segmentation MVP) and tests. Added Buffer::set_redraw helper for cursor movement parity.","created_at":"2026-01-29T04:48:02Z"}]}
{"id":"moon_cosmic-vvr.3","title":"Implement FontSystem + font fallback parity","description":"Bring FontSystem/font module in line with cosmic-text-reference: font discovery, family/style/weight matching, fallback lists, and glyph availability checks.","status":"open","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T12:21:33.437686+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:21:33.437686+08:00","labels":["fallback","font"],"dependencies":[{"issue_id":"moon_cosmic-vvr.3","depends_on_id":"moon_cosmic-vvr","type":"parent-child","created_at":"2026-01-29T12:21:33.43835+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-vvr.4","title":"Implement bidi paragraph boundaries + visual runs","description":"Match cosmic-text bidi paragraph handling and visual order runs (beyond base-direction heuristic), including paragraph iteration and selection behavior.","status":"open","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T12:21:33.524981+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:21:33.524981+08:00","labels":["bidi"],"dependencies":[{"issue_id":"moon_cosmic-vvr.4","depends_on_id":"moon_cosmic-vvr","type":"parent-child","created_at":"2026-01-29T12:21:33.525631+08:00","created_by":"Milky2018"}]}
{"id":"moon_cosmic-vvr.5","title":"Port/align test suite with cosmic-text-reference","description":"Add MoonBit tests that mirror cosmic-text-reference behavior (layout, shaping, editing, selection, raster cache).","status":"open","priority":1,"issue_type":"task","owner":"842376130@qq.com","created_at":"2026-01-29T12:21:33.612474+08:00","created_by":"Milky2018","updated_at":"2026-01-29T12:21:33.612474+08:00","labels":["tests"],"dependencies":[{"issue_id":"moon_cosmic-vvr.5","depends_on_id":"moon_cosmic-vvr","type":"parent-child","created_at":"2026-01-29T12:21:33.613219+08:00","created_by":"Milky2018"}]}
